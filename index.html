<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCSE Study Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            /* Foundational Palette */
            --color-background: #0D0D0D;
            --color-surface: #171717;
            --color-surface-hover: #212121;
            --color-outline: #2C2C2C;
            --color-outline-hover: #444444;

            --color-text-primary: #F5F5F5;
            --color-text-secondary: #8A8A8A;
            --color-text-tertiary: #5A5A5A;
            
            /* Accent Palette */
            --color-accent: #FFFFFF;
            --color-accent-text: #000000;
            
            /* RAG Palette for high contrast */
            --rag-red: #EF4444;
            --rag-amber: #D97706;
            --rag-green: #059669;

            /* Sizing & Spacing System (4px base) - Base sizes for desktop */
            --space-1: 4px;  --space-2: 8px;  --space-3: 12px; --space-4: 16px;
            --space-5: 20px; --space-6: 24px; --space-7: 32px; --space-8: 40px;

            /* Shape System */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 999px;

            /* Typography System - Base sizes for desktop */
            --font-size-xs: 12px; --font-size-sm: 14px; --font-size-md: 16px;
            --font-size-lg: 20px; --font-size-xl: 24px; --font-size-xxl: 32px;

            /* Motion System */
            --easing: cubic-bezier(0.16, 1, 0.3, 1);
            --transition-speed: 0.25s;
        }
        
        @keyframes slideUpFadeIn { from { opacity: 0; transform: translateY(var(--space-2)); } to { opacity: 1; transform: translateY(0); } }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { scroll-behavior: smooth; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-background); 
            color: var(--color-text-primary); 
            line-height: 1.6; 
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 var(--space-6); }
        .hidden { display: none !important; }

        /* Main Views */
        .onboarding, .main-dashboard, .spec-view { animation: slideUpFadeIn 0.6s var(--easing) both; }

        /* Modal Base Styles */
        .modal { 
            display: flex; position: fixed; inset: 0; padding: var(--space-4); z-index: 1000; 
            align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(12px); opacity: 0; visibility: hidden;
            transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
        }
        .modal.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--color-surface); border-radius: var(--radius-xl); width: 100%; max-width: 560px;
            border: 1px solid var(--color-outline); display: flex; flex-direction: column; max-height: 90vh;
            transform: scale(0.95); transition: transform var(--transition-speed) var(--easing);
        }
        .modal.visible .modal-content { transform: scale(1); }
        .modal-header {
            padding: var(--space-5) var(--space-6); border-bottom: 1px solid var(--color-outline); flex-shrink: 0;
        }
        .modal-header h2 { font-size: var(--font-size-lg); font-weight: 700; text-align: center; }
        .modal-body { padding: var(--space-6); flex-grow: 1; overflow-y: auto; }
        .modal-footer {
            display: flex; justify-content: flex-end; gap: var(--space-3); padding: var(--space-4) var(--space-6);
            border-top: 1px solid var(--color-outline); background-color: var(--color-surface);
            border-bottom-left-radius: var(--radius-xl); border-bottom-right-radius: var(--radius-xl); flex-shrink: 0;
        }

        /* Onboarding Screen */
        .onboarding { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: var(--space-4); }
        .onboarding-card {
            background: var(--color-surface); border-radius: var(--radius-xl); padding: var(--space-8); width: 100%; 
            max-width: 720px; border: 1px solid var(--color-outline); text-align: center;
        }
        .onboarding-card h1 { font-size: var(--font-size-xxl); font-weight: 700; margin-bottom: var(--space-2); }
        .onboarding-card p { color: var(--color-text-secondary); font-size: var(--font-size-md); margin-bottom: var(--space-7); max-width: 450px; margin-left: auto; margin-right: auto;}
        .onboarding-card .subject-grid { margin-bottom: var(--space-7); }
        
        /* Countdown Timer */
        .countdown-container { text-align: center; padding: var(--space-7) 0; }
        .countdown-container h2 { font-size: var(--font-size-sm); font-weight: 600; color: var(--color-text-secondary); margin-bottom: var(--space-4); letter-spacing: 0.5px; text-transform: uppercase; }
        .countdown-timer { display: flex; justify-content: center; gap: var(--space-4); }
        .countdown-item { background: var(--color-surface); border: 1px solid var(--color-outline); padding: var(--space-4); border-radius: var(--radius-lg); min-width: 90px; }
        .countdown-item .value { font-size: var(--font-size-xxl); font-weight: 700; line-height: 1.1; color: var(--color-accent); }
        .countdown-item .label { font-size: var(--font-size-xs); color: var(--color-text-secondary); margin-top: var(--space-2); }

        /* Subject Grid */
        .subject-grid { display: grid; grid-template-columns: 1fr; gap: var(--space-3); }
        .subject-card { 
            border-radius: var(--radius-lg); padding: var(--space-5); cursor: pointer; 
            transition: all var(--transition-speed) var(--easing); border: 1px solid var(--color-outline); 
            background-color: var(--color-surface); display: flex; align-items: center; justify-content: space-between;
        }
        .subject-card:hover { transform: translateY(-4px); border-color: var(--color-outline-hover); background-color: var(--color-surface-hover); }
        .subject-card.selected { border-color: var(--color-accent); background-color: var(--color-surface); }
        .subject-card h3 { font-size: var(--font-size-md); font-weight: 600; color: var(--color-text-primary); pointer-events: none; }
        .subject-card.selected h3 { color: var(--color-accent); }
        .exam-board-pill {
            font-size: var(--font-size-xs); font-weight: 600; padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full); background-color: var(--color-background);
            color: var(--color-text-secondary); border: 1px solid var(--color-outline);
            text-transform: uppercase; letter-spacing: 0.5px; flex-shrink: 0;
        }
        
        /* Spec View Header */
        .spec-header {
            position: sticky; top: 0; background-color: rgba(13, 13, 13, 0.8);
            backdrop-filter: blur(12px); z-index: 101; border-bottom: 1px solid var(--color-outline);
            margin-bottom: var(--space-7); padding: var(--space-4) var(--space-6);
        }
        .spec-header-main { display: flex; flex-wrap: wrap; align-items: center; gap: var(--space-4); }
        .spec-header h1 { font-size: var(--font-size-xl); font-weight: 700; margin-right: auto; display: flex; align-items: center; gap: var(--space-3); flex-shrink: 1; min-width: 0; }
        .spec-header h1 span:first-child { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* Summary Bar Filter */
        .spec-summary-bar { display: flex; gap: var(--space-2); margin-left: auto; }
        .summary-item {
            display: flex; align-items: center; gap: var(--space-2);
            background-color: var(--color-surface); border: 1px solid var(--color-outline);
            padding: var(--space-2) var(--space-3); border-radius: var(--radius-md);
            font-size: var(--font-size-sm); font-weight: 600; color: var(--color-text-secondary);
            cursor: pointer; transition: all var(--transition-speed) ease;
        }
        .summary-item:hover { background-color: var(--color-surface-hover); border-color: var(--color-outline-hover); color: var(--color-text-primary); }
        .summary-item.active {
            border-color: var(--color-accent);
            color: var(--color-text-primary);
        }
        .summary-item .dot { width: 8px; height: 8px; border-radius: 50%; }
        .summary-item .dot.red { background-color: var(--rag-red); }
        .summary-item .dot.amber { background-color: var(--rag-amber); }
        .summary-item .dot.green { background-color: var(--rag-green); }

        /* Buttons */
        .md-button { display: inline-flex; align-items: center; justify-content: center; gap: var(--space-2); height: 44px; padding: 0 var(--space-5); border-radius: var(--radius-md); border: 1px solid var(--color-accent); background: var(--color-accent); color: var(--color-accent-text); font-size: var(--font-size-sm); font-weight: 600; cursor: pointer; transition: all var(--transition-speed) var(--easing); text-decoration: none; }
        .md-button:hover { transform: scale(1.03); }
        .md-button:active { transform: scale(0.98); }
        .md-button:disabled { background: var(--color-surface); color: var(--color-text-tertiary); border-color: var(--color-outline); cursor: not-allowed; transform: none;}
        .md-button .material-icons { font-size: var(--font-size-lg); }
        .md-button.text { background: transparent; color: var(--color-text-primary); border-color: var(--color-outline); }
        .md-button.text:hover { background-color: var(--color-surface-hover); border-color: var(--color-outline-hover); }
        .md-button.text.destructive { color: var(--rag-red); border-color: var(--color-outline); }
        .md-button.text.destructive:hover { border-color: var(--rag-red); background-color: rgba(239, 68, 68, 0.1); }
        .dashboard-footer { text-align: center; margin-top: var(--space-7); }
        .dashboard-divider { display: flex; align-items: center; text-align: center; margin: var(--space-7) 0; color: var(--color-text-secondary); }
        .dashboard-divider::before, .dashboard-divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--color-outline); }
        .dashboard-divider:not(:empty)::before { margin-right: 1em; }
        .dashboard-divider:not(:empty)::after { margin-left: 1em; }
        .dashboard-divider h2 { font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Specification Content */
        .paper-section { background: var(--color-surface); border: 1px solid var(--color-outline); border-radius: var(--radius-xl); margin-bottom: var(--space-7); overflow: hidden; }
        .paper-header { padding: var(--space-5) var(--space-6); font-size: var(--font-size-lg); font-weight: 700; display: flex; justify-content: space-between; align-items: center; gap: var(--space-4); }
        .paper-header-title { display: flex; align-items: center; gap: var(--space-3); flex-grow: 1; }
        .paper-completion-pill { font-size: var(--font-size-xs); font-weight: 600; padding: var(--space-1) var(--space-3); border-radius: var(--radius-full); background-color: var(--color-background); color: var(--color-text-secondary); border: 1px solid var(--color-outline); white-space: nowrap; }
        .topic { border-top: 1px solid var(--color-outline); }
        .topic-header { padding: var(--space-3) var(--space-6); background-color: var(--color-background); }
        .topic-header-content { font-weight: 600; font-size: var(--font-size-sm); color: var(--color-text-secondary); }
        .subtopic { padding: var(--space-4) var(--space-6); border-top: 1px solid var(--color-outline); transition: background-color var(--transition-speed) ease; display: flex; justify-content: space-between; align-items: center; gap: var(--space-4); }
        .subtopic:hover { background-color: var(--color-surface-hover); }
        .subtopic-title { font-size: var(--font-size-sm); flex-grow: 1; padding-right: var(--space-4); }
        .subtopic-details { display: flex; align-items: center; gap: var(--space-2); flex-shrink: 0; position: relative; }
        
        /* Topic Progress Bar */
        .topic-progress-bar {
            width: 100%; background-color: var(--color-outline); height: 4px;
            border-radius: var(--radius-full); overflow: hidden; margin-top: var(--space-2);
        }
        .topic-progress-fill {
            width: 0%; height: 100%; background-color: var(--rag-green);
            transition: width 0.5s var(--easing);
        }

        /* Timestamp Tooltip */
        .review-timestamp-tooltip {
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            margin-bottom: var(--space-3); background-color: var(--color-surface-hover);
            color: var(--color-text-primary); padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md); font-size: var(--font-size-xs); font-weight: 500;
            white-space: nowrap; opacity: 0; visibility: hidden; pointer-events: none;
            transition: opacity var(--transition-speed) ease, margin-bottom var(--transition-speed) ease;
        }
        .subtopic-details:hover .review-timestamp-tooltip {
            opacity: 1; visibility: visible; margin-bottom: var(--space-2);
        }
        
        /* RAG dot styling */
        .rag-selector { display: flex; align-items: center; gap: var(--space-2); flex-shrink: 0; }
        .rag-dot {
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: all var(--transition-speed) var(--easing);
            opacity: 0.6; display: flex; align-items: center; justify-content: center;
        }
        .rag-dot:hover { opacity: 1; transform: scale(1.1); }
        .rag-dot .check-icon { display: none; font-size: 16px; font-weight: 700; color: var(--color-text-primary); }
        
        .rag-dot.selected {
            opacity: 1; transform: scale(1.1); border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 16px -2px var(--shadow-color);
        }
        .rag-dot.selected .check-icon { display: block; }
        
        .rag-dot.red { background-color: var(--rag-red); --shadow-color: var(--rag-red); }
        .rag-dot.amber { background-color: var(--rag-amber); --shadow-color: var(--rag-amber); }
        .rag-dot.green { background-color: var(--rag-green); --shadow-color: var(--rag-green); }
        .subtopic.filtered-out, .topic.filtered-out { display: none; }

        /* Desktop-only styles */
        @media (min-width: 769px) {
            .subject-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
            #onboarding .subject-card, #settingsModal .subject-card { flex-direction: column; justify-content: center; text-align: center; gap: var(--space-3); }
            .spec-header-main { flex-wrap: nowrap; }
            .spec-header h1 { font-size: var(--font-size-xxl); }
        }

        /* Mobile-only styles and refined sizing */
        @media (max-width: 768px) {
            :root {
                --space-1: 3px;  --space-2: 6px;  --space-3: 10px; --space-4: 14px;
                --space-5: 18px; --space-6: 20px; --space-7: 28px; --space-8: 36px;
                --font-size-xs: 11px; --font-size-sm: 13px; --font-size-md: 15px;
                --font-size-lg: 18px; --font-size-xl: 22px; --font-size-xxl: 26px;
            }

            .container { padding: 0 var(--space-4); }
            .onboarding-card { padding: var(--space-7) var(--space-4); }
            .onboarding-card h1 { font-size: var(--font-size-xl); }
            .countdown-container { padding: var(--space-6) 0; }
            .countdown-timer { gap: var(--space-2); }
            .countdown-item { padding: var(--space-3); min-width: 65px; border-radius: var(--radius-md); }
            .countdown-item .value { font-size: var(--font-size-xl); }
            .countdown-item .label { font-size: 10px; margin-top: var(--space-1); }

            .spec-header { padding: var(--space-3) var(--space-4); flex-direction: column; align-items: stretch; gap: var(--space-3); }
            .spec-header-main { justify-content: space-between; gap: var(--space-3); }
            .spec-header h1 { font-size: var(--font-size-lg); margin: 0; }
            .spec-summary-bar { justify-content: center; flex-wrap: wrap; margin-left: 0; }
            
            .paper-section { border-radius: var(--radius-lg); }
            .paper-header { padding: var(--space-4); font-size: var(--font-size-md); }
            .topic-header { padding: var(--space-3) var(--space-4); }
            .subtopic { flex-direction: column; align-items: flex-start; gap: var(--space-3); padding: var(--space-4); }
            .subtopic-details { width: 100%; justify-content: space-between; }
            .subtopic-title { padding-right: 0; }

            .md-button { height: 40px; padding: 0 var(--space-4); font-size: var(--font-size-sm); }
            .modal-content { border-radius: var(--radius-lg); }
            .modal-header, .modal-footer { padding: var(--space-4); }
            .modal-body { padding: var(--space-5); }
        }
    </style>
</head>
<body>
    <div id="onboarding" class="onboarding">
        <div class="onboarding-card">
            <h1>Welcome to Your Study Hub</h1>
            <p>Select your subjects to build a personalized tracker and take control of your revision.</p>
            <div class="subject-grid" id="onboardingSubjectGrid"></div>
            <button class="md-button" id="continueBtn" disabled>
                <span>Continue</span>
                <span class="material-icons">arrow_forward</span>
            </button>
        </div>
    </div>
    
    <div id="main-dashboard" class="main-dashboard hidden">
        <div class="container">
            <div class="countdown-container">
                <h2>Time until May 2026 GCSE Exams</h2>
                <div class="countdown-timer" id="countdownTimer"></div>
            </div>
            <div class="dashboard-divider"><h2>Your Subjects</h2></div>
            <div class="subject-grid" id="dashboardSubjectGrid"></div>
            <div class="dashboard-footer">
                <button class="md-button text" id="editSubjectsBtn">
                    <span class="material-icons">edit</span>
                    <span>Edit Subjects</span>
                </button>
            </div>
        </div>
    </div>

    <div id="spec-view" class="spec-view hidden">
        <div class="container">
            <div class="spec-header">
                <div class="spec-header-main">
                    <button class="md-button text" id="backToDashBtn" title="Back to Dashboard">
                        <span class="material-icons">arrow_back</span>
                    </button>
                    <h1 id="specSubjectTitle"></h1>
                    <div class="spec-summary-bar" id="specSummaryBar"></div>
                </div>
            </div>
            <div id="specContent"></div>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Edit Subjects</h2></div>
            <div class="modal-body">
                <div class="subject-grid" id="settingsSubjectGrid"></div>
            </div>
            <div class="modal-footer">
                <button class="md-button text" id="cancelSettings">Cancel</button>
                <button class="md-button" id="saveSettings">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Data containing all subject specifications
        const subjectsData = {
            'Mathematics':{specifications:{'Edexcel':{'Paper 1 (Non-Calculator)':{'Number':['Calculations with integers and decimals','Fractions and percentages','Indices and standard form','Surds'],'Algebra':['Simplifying expressions','Linear equations and inequalities','Sequences','Straight line graphs']},'Paper 2 (Calculator)':{'Number and Finance':['Percentage calculations','Compound interest','Estimation and approximation','Problem solving with money'],'Geometry and Measures':['Perimeter, area and volume','Transformations','Constructions and loci','Pythagoras and trigonometry']},'Paper 3 (Calculator)':{'Statistics and Probability':['Collecting and representing data','Averages and measures of spread','Probability','Tree diagrams and conditional probability'],'Advanced Topics':['Quadratic equations and graphs','Simultaneous equations','Circle theorems','Vectors']}}}},
            'English Language':{specifications:{'AQA':{'Paper 1: Explorations in Creative Reading and Writing':{'Reading':['Identify and interpret explicit and implicit information','Explain and analyse how writers use language','Evaluate texts critically','Compare writers\' ideas and perspectives'],'Writing':['Creative writing for a specified audience, purpose and form','Demonstrate effective use of vocabulary','Use a range of sentence structures','Use paragraphs effectively']},'Paper 2: Writers\' Viewpoints and Perspectives':{'Reading (19th and 21st Century Non-fiction)':['Identify and interpret explicit and implicit information','Analyse how writers use language and structure','Evaluate texts critically','Compare writers\' ideas and perspectives'],'Writing (Transactional)':['Write to express viewpoints','Write for a specified audience, purpose and form','Organise information and ideas','Use vocabulary and sentence structures appropriately']}}}},
            'English Literature':{specifications:{'AQA':{'Paper 1: Shakespeare and the 19th-century novel':{'Shakespeare (Macbeth)':['Plot and character analysis','Themes (e.g., ambition, guilt)','Context (historical, cultural)','Language, structure, and form'],'19th-Century Novel (A Christmas Carol)':['Plot and characterisation','Themes (e.g., poverty, redemption)','Setting and narrative techniques','Social and historical context']},'Paper 2: Modern texts and poetry':{'Modern Prose/Drama (An Inspector Calls)':['Character motivations and roles','Dramatic techniques and structure','Social, political, and historical context','Themes (e.g., social responsibility)'],'Poetry (Power and Conflict Cluster)':['Analysis of 15 set poems','Comparing poems on themes','Analysing language and structure','Understanding context']}}}},
            'Biology':{specifications:{'AQA':{'Paper 1':{'1. Cell biology':['Cell structure','Cell division','Transport in cells'],'2. Organisation':['Principles of organisation','Animal tissues, organs and systems','Plant tissues, organs and systems'],'3. Infection and response':['Communicable diseases','Viral, bacterial, protist and fungal diseases','Human defence systems','Vaccination','Antibiotics and painkillers'],'4. Bioenergetics':['Photosynthesis','Respiration']},'Paper 2':{'5. Homeostasis and response':['The human nervous system','The endocrine system','Hormonal coordination in humans'],'6. Inheritance, variation and evolution':['Reproduction','Variation and evolution','The development of genetics','Cloning'],'7. Ecology':['Adaptations, interdependence and competition','Organisation of an ecosystem','Biodiversity and human interaction','Trophic levels and food production']}}}},
            'Chemistry':{specifications:{'AQA':{'Paper 1':{'1. Atomic structure and the periodic table':['Atoms, elements and compounds','The periodic table','Properties of transition metals'],'2. Bonding, structure, and the properties of matter':['Chemical bonds','Properties of different structures','Structure and bonding of carbon'],'3. Quantitative chemistry':['Chemical measurements','Use of amount of substance in equations','Yield and atom economy'],'4. Chemical changes':['Reactivity of metals','Reactions of acids','Electrolysis'],'5. Energy changes':['Exothermic and endothermic reactions','Chemical cells and fuel cells']},'Paper 2':{'6. The rate and extent of chemical change':['Rate of reaction','Reversible reactions and dynamic equilibrium'],'7. Organic chemistry':['Carbon compounds as fuels and feedstock','Reactions of alkenes and alcohols','Synthetic and naturally occurring polymers'],'8. Chemical analysis':['Purity, formulations and chromatography','Identification of common gases and ions'],'9. Chemistry of the atmosphere':['The composition and evolution of the Earth’s atmosphere','Common atmospheric pollutants and their sources'],'10. Using resources':['Using the Earth’s resources and sustainable development','Potable water','Life cycle assessment and recycling']}}}},
            'Physics':{specifications:{'AQA':{'Paper 1':{'1. Energy':['Energy changes in a system','Conservation and dissipation of energy','National and global energy resources'],'2. Electricity':['Current, potential difference and resistance','Series and parallel circuits','Domestic uses and safety','Static electricity'],'3. Particle model of matter':['Changes of state and the particle model','Internal energy and energy transfers','Particle model and pressure'],'4. Atomic structure':['Atoms and isotopes','Atoms and nuclear radiation','Nuclear fission and fusion']},'Paper 2':{'5. Forces':['Forces and their interactions','Work done and energy transfer','Forces and elasticity','Pressure and pressure differences in fluids','Moments, levers and gears'],'6. Waves':['Wave properties','Electromagnetic waves','Black body radiation'],'7. Magnetism and electromagnetism':['Permanent and induced magnetism','The motor effect','Induced potential, transformers and the National Grid'],'8. Space physics':['Solar system; stability of orbital motions; satellites','Red-shift and the Big Bang theory']}}}},
            'Geography':{specifications:{'AQA':{'Paper 1: Living with the physical environment':{'1. The challenge of natural hazards':['Natural hazards','Tectonic hazards','Weather hazards','Climate change'],'2. The living world':['Ecosystems','Tropical rainforests','Hot deserts','Cold environments'],'3. Physical landscapes in the UK':['UK physical landscapes','Coastal landscapes in the UK','River landscapes in the UK','Glacial landscapes in the UK']},'Paper 2: Challenges in the human environment':{'4. Urban issues and challenges':['The urban world','Urban change in the UK','Urban sustainability'],'5. The changing economic world':['The development gap','Newly emerging economies (NEEs)','The changing UK economy'],'6. The challenge of resource management':['Resource management','Food management','Water management','Energy management']}}}},
            'Computer Science':{specifications:{'OCR':{'Component 01: Computer systems':{'1.1 Systems Architecture':['The purpose of the CPU','Von Neumann architecture','Common CPU components and their function','The fetch-execute cycle'],'1.2 Memory & Storage':['The difference between RAM and ROM','The purpose of virtual memory','Flash memory','Types of storage: optical, magnetic, solid state'],'1.3 Computer Networks, Connections & Protocols':['Types of networks: LAN and WAN','Factors that affect network performance','The Internet and the DNS','Network topologies, hardware and protocols'],'1.4 Network Security':['Threats to computer systems and networks','Identifying and preventing vulnerabilities'],'1.s System Software':['Operating systems functions','User interface types','Memory management and multitasking','Utility system software'],'1.6 Ethical, Legal, Cultural & Environmental Impacts':['Impacts of digital technology on society','Legislation (e.g., Data Protection Act, Computer Misuse Act)','Open source vs proprietary software']},'Component 02: Computational thinking, algorithms and programming':{'2.1 Algorithms':['Computational thinking','Standard searching and sorting algorithms','Producing algorithms using pseudocode and flowcharts'],'2.2 Programming Fundamentals':['Variables, constants, operators, inputs, outputs, assignment','Programming constructs (sequence, selection, iteration)','String manipulation','Data types and arrays','Subroutines (functions and procedures)'],'2.3 Producing Robust Programs':['Defensive design','Maintainability','Testing','Syntax and logic errors'],'2.4 Boolean Logic':['Simple logic diagrams (AND, OR, NOT)','Truth tables','Combining Boolean operators'],'2.5 Programming Languages & IDEs':['High-level and low-level languages','Translators (compilers and interpreters)','Integrated Development Environment (IDE) tools']}}}}
        };

        // Application State
        let selectedSubjects = [];
        let ragStatus = {};
        let currentRagFilter = 'all';
        let countdownInterval;
        let currentContext = { subject: null };
        const views = {};
        const modals = {};
        let lastFocusedElement;

        // --- Core Application Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            Object.assign(views, {onboarding: document.getElementById('onboarding'),dashboard: document.getElementById('main-dashboard'),spec: document.getElementById('spec-view')});
            document.querySelectorAll('.modal').forEach(modal => { modals[modal.id] = modal; });

            try { 
                const data = JSON.parse(localStorage.getItem('studyTrackerDataV2'));
                if(data) { 
                    selectedSubjects = data.selectedSubjects || []; 
                    ragStatus = data.ragStatus || {};
                }
            } catch (e) { console.error("Could not parse data, starting fresh.", e); }
            
            if (selectedSubjects.length > 0) { showView('dashboard'); } 
            else { showView('onboarding'); }
            addEventListeners();
        });

        function saveData() { localStorage.setItem('studyTrackerDataV2', JSON.stringify({ selectedSubjects, ragStatus })); }

        function addEventListeners() {
            document.body.addEventListener('click', e => {
                const target = e.target;
                const closest = (selector) => target.closest(selector);
                
                if (target.classList.contains('modal')) { hideModal(target.id); }

                const button = closest('button');
                if (button) {
                    const id = button.id;
                    if (id === 'continueBtn') { if (selectedSubjects.length > 0) { saveData(); showView('dashboard'); } }
                    else if (id === 'editSubjectsBtn') { renderSettingsModal(); showModal('settingsModal'); }
                    else if (id === 'backToDashBtn') showView('dashboard');
                    
                    if (id === 'cancelSettings') hideModal(closest('.modal').id);
                    if (id === 'saveSettings') handleSaveSettings();
                }
                
                const subjectCard = closest('.subject-card');
                if (subjectCard) {
                    if(document.getElementById('main-dashboard').contains(subjectCard)) showSpecView(subjectCard.dataset.subject);
                    if(document.getElementById('onboarding').contains(subjectCard)) toggleOnboardingSubject(subjectCard);
                    if(document.getElementById('settingsModal').contains(subjectCard)) toggleSettingsSubject(subjectCard);
                }

                const ragDot = closest('.rag-dot');
                if (ragDot) { handleRagSelection(ragDot); }

                const filterTrigger = closest('.summary-item');
                if (filterTrigger) {
                    currentRagFilter = filterTrigger.dataset.filter;
                    document.querySelectorAll('.summary-item').forEach(btn => btn.classList.remove('active'));
                    filterTrigger.classList.add('active');
                    applyRagFilter();
                }
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const visibleModal = document.querySelector('.modal.visible');
                    if (visibleModal) { hideModal(visibleModal.id); }
                }
            });
        }

        function handleRagSelection(element) {
            const subtopicKey = element.closest('.rag-selector').dataset.subtopicKey;
            const newStatus = element.dataset.status;

            if (element.classList.contains('selected')) {
                delete ragStatus[subtopicKey];
            } else {
                ragStatus[subtopicKey] = { status: newStatus, timestamp: new Date().toISOString() };
            }
            saveData();

            const subtopicEl = element.closest('.subtopic');
            if (subtopicEl) {
                const newSubtopicEl = createSubtopicElement( subtopicEl.dataset.subject, subtopicEl.dataset.examBoard, subtopicEl.dataset.paper, subtopicEl.dataset.topic, subtopicEl.dataset.subtopic );
                subtopicEl.parentNode.replaceChild(newSubtopicEl, subtopicEl);
            }
            
            updatePaperCompletionPercentages();
            updateAllTopicProgress();
            renderSummaryBar();
            applyRagFilter();
        }

        function applyRagFilter() {
            const topics = document.querySelectorAll('#specContent .topic');
            topics.forEach(topic => {
                let hasVisibleSubtopic = false;
                const subtopics = topic.querySelectorAll('.subtopic');
                subtopics.forEach(subtopic => {
                    const subtopicKey = subtopic.querySelector('.rag-selector').dataset.subtopicKey;
                    const entry = ragStatus[subtopicKey];
                    const status = entry ? entry.status : null;

                    if (currentRagFilter === 'all' || status === currentRagFilter) {
                        subtopic.classList.remove('filtered-out');
                        hasVisibleSubtopic = true;
                    } else {
                        subtopic.classList.add('filtered-out');
                    }
                });
                topic.classList.toggle('filtered-out', !hasVisibleSubtopic);
            });
        }
        
        function updatePaperCompletionPercentages() {
            document.querySelectorAll('.paper-section').forEach(paperSection => {
                const subtopics = paperSection.querySelectorAll('.subtopic');
                const totalSubtopics = subtopics.length;
                if (totalSubtopics === 0) return;

                let ratedCount = 0;
                subtopics.forEach(subtopic => {
                    const subtopicKey = subtopic.querySelector('.rag-selector').dataset.subtopicKey;
                    if (ragStatus[subtopicKey]) ratedCount++;
                });

                const percentage = totalSubtopics > 0 ? Math.round((ratedCount / totalSubtopics) * 100) : 0;
                const pill = paperSection.querySelector('.paper-completion-pill');
                if(pill) pill.textContent = `${percentage}% Reviewed`;
            });
        }

        function showView(viewName) { 
            Object.values(views).forEach(v => v.classList.add('hidden')); 
            if (views[viewName]) views[viewName].classList.remove('hidden'); 
            if (viewName === 'onboarding') renderOnboardingContent(); 
            if (viewName === 'dashboard') { renderDashboardContent(); startCountdown(); } 
            if (viewName !== 'dashboard') stopCountdown();
        }
        
        function showModal(modalId) { 
            const modal = modals[modalId];
            if(!modal) return;
            lastFocusedElement = document.activeElement;
            modal.classList.add('visible');
            modal.addEventListener('keydown', handleFocusTrap);
            const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (focusableElements.length > 0) { setTimeout(() => focusableElements[0].focus(), 100); }
        }
        
        function hideModal(modalId) { 
            const modal = modals[modalId];
            if(!modal) return;
            modal.classList.remove('visible');
            modal.removeEventListener('keydown', handleFocusTrap);
            if(lastFocusedElement) { lastFocusedElement.focus(); }
        }

        function handleFocusTrap(e) {
            if (e.key !== 'Tab') return;
            const modal = e.currentTarget;
            const focusableElements = Array.from(modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(el => !el.disabled && el.offsetParent !== null);
            if(focusableElements.length === 0) return;
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            if (e.shiftKey) { if (document.activeElement === firstElement) { lastElement.focus(); e.preventDefault(); } } 
            else { if (document.activeElement === lastElement) { firstElement.focus(); e.preventDefault(); } }
        }
        
        function showSpecView(subject) { 
            currentContext.subject = subject; 
            const subjectInfo = subjectsData[subject];
            const examBoard = Object.keys(subjectInfo.specifications)[0];
            document.getElementById('specSubjectTitle').innerHTML = `<span>${subject}</span><span class="exam-board-pill">${examBoard}</span>`; 
            
            currentRagFilter = 'all';
            renderSpecContent(subject); 
            showView('spec'); 
        }

        function renderSpecContent(subject) { 
            const contentEl = document.getElementById('specContent'); 
            const subjectInfo = subjectsData[subject]; 
            if (!subjectInfo) { contentEl.innerHTML = '<p>Subject data not available.</p>'; return; } 
            const examBoard = Object.keys(subjectInfo.specifications)[0]; 
            const specification = subjectInfo.specifications[examBoard]; 
            if (!specification) { contentEl.innerHTML = '<p>Specification data not available.</p>'; return; } 
            
            contentEl.innerHTML = ''; 
            Object.keys(specification).forEach((paper, i) => { 
                const paperEl = document.createElement('div'); 
                paperEl.className = 'paper-section';
                paperEl.style.animationDelay = `${i * 100}ms`;
                paperEl.dataset.paper = paper;
                paperEl.dataset.subject = subject;
                paperEl.appendChild(createPaperHeaderElement(subject, paper)); 
                Object.keys(specification[paper]).forEach(topic => { 
                    const topicEl = document.createElement('div'); 
                    topicEl.className = 'topic'; 
                    topicEl.dataset.topicName = topic;
                    topicEl.innerHTML = `<div class="topic-header"><div class="topic-header-content">${topic}</div><div class="topic-progress-bar"><div class="topic-progress-fill"></div></div></div>`; 
                    specification[paper][topic].forEach(subtopic => topicEl.appendChild(createSubtopicElement(subject, examBoard, paper, topic, subtopic))); 
                    paperEl.appendChild(topicEl); 
                }); 
                contentEl.appendChild(paperEl); 
            }); 
            updatePaperCompletionPercentages();
            updateAllTopicProgress();
            renderSummaryBar();
            applyRagFilter();
        }
        
        function createSubtopicElement(subject, examBoard, paper, topic, subtopic) { 
            const subtopicEl = document.createElement('div'); 
            subtopicEl.className = 'subtopic'; 
            subtopicEl.dataset.subject = subject; subtopicEl.dataset.examBoard = examBoard;
            subtopicEl.dataset.paper = paper; subtopicEl.dataset.topic = topic; subtopicEl.dataset.subtopic = subtopic;

            const subtopicKey = `${subject}-${paper}-${topic}-${subtopic}`.replace(/[^a-zA-Z0-9-]/g, '-').toLowerCase();
            const ragEntry = ragStatus[subtopicKey];
            const currentStatus = ragEntry ? ragEntry.status : null;
            const timestamp = ragEntry ? ragEntry.timestamp : null;

            const formattedDate = timestamp 
                ? `Last reviewed: ${new Date(timestamp).toLocaleString('en-GB', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit', hour12: false }).replace(',', '')}`
                : 'Not reviewed yet';

            subtopicEl.innerHTML = `
                <div class="subtopic-title">${subtopic}</div>
                <div class="subtopic-details">
                    <div class="review-timestamp-tooltip">${formattedDate}</div>
                    <div class="rag-selector" data-subtopic-key="${subtopicKey}">
                        <div class="rag-dot red ${currentStatus === 'red' ? 'selected' : ''}" data-status="red" title="Not Confident"><span class="material-icons check-icon">check</span></div>
                        <div class="rag-dot amber ${currentStatus === 'amber' ? 'selected' : ''}" data-status="amber" title="Needs Review"><span class="material-icons check-icon">check</span></div>
                        <div class="rag-dot green ${currentStatus === 'green' ? 'selected' : ''}" data-status="green" title="Confident"><span class="material-icons check-icon">check</span></div>
                    </div>
                </div>`;
            return subtopicEl; 
        }

        function createPaperHeaderElement(subject, paper) { 
            const paperEl = document.createElement('div'); 
            paperEl.className = 'paper-header'; 
            paperEl.dataset.paperKey = `${subject}-${paper}`; 
            paperEl.innerHTML = `
                <div class="paper-header-title">
                    <span>${paper}</span>
                    <span class="paper-completion-pill">0% Reviewed</span>
                </div>`; 
            return paperEl; 
        }

        function updateAllTopicProgress() {
            document.querySelectorAll('.topic').forEach(topicEl => {
                const subtopics = topicEl.querySelectorAll('.subtopic');
                const totalSubtopics = subtopics.length;
                if (totalSubtopics === 0) return;

                let greenCount = 0;
                subtopics.forEach(st => {
                    const key = st.querySelector('.rag-selector').dataset.subtopicKey;
                    if (ragStatus[key]?.status === 'green') {
                        greenCount++;
                    }
                });
                
                const percentage = totalSubtopics > 0 ? (greenCount / totalSubtopics) * 100 : 0;
                const fillEl = topicEl.querySelector('.topic-progress-fill');
                if (fillEl) fillEl.style.width = `${percentage}%`;
            });
        }

        function renderSummaryBar() {
            const summaryBar = document.getElementById('specSummaryBar');
            if (!summaryBar) return;
            const counts = { red: 0, amber: 0, green: 0 };
            const allSubtopicKeys = Array.from(document.querySelectorAll('.rag-selector')).map(el => el.dataset.subtopicKey);
            
            allSubtopicKeys.forEach(key => {
                const status = ragStatus[key]?.status;
                if (status && counts.hasOwnProperty(status)) {
                    counts[status]++;
                }
            });

            summaryBar.innerHTML = `
                <div class="summary-item active" data-filter="all" title="Show All Topics"><span>All</span></div>
                <div class="summary-item" data-filter="red" title="Filter 'Not Confident'"><span class="dot red"></span><span>${counts.red}</span></div>
                <div class="summary-item" data-filter="amber" title="Filter 'Needs Review'"><span class="dot amber"></span><span>${counts.amber}</span></div>
                <div class="summary-item" data-filter="green" title="Filter 'Confident'"><span class="dot green"></span><span>${counts.green}</span></div>
            `;
        }
        
        function toggleOnboardingSubject(card) { const subject = card.dataset.subject; const isSelected = card.classList.toggle('selected'); if (isSelected) { if (!selectedSubjects.includes(subject)) selectedSubjects.push(subject); } else { selectedSubjects = selectedSubjects.filter(s => s !== subject); } updateContinueButton(); }
        function toggleSettingsSubject(card) { card.classList.toggle('selected'); updateSaveButtonState(); }
        function updateContinueButton() { const btn = document.getElementById('continueBtn'); if (!btn) return; btn.disabled = selectedSubjects.length === 0; const text = btn.querySelector('span:first-child'); text.textContent = selectedSubjects.length > 0 ? `Continue with ${selectedSubjects.length} subject${selectedSubjects.length > 1 ? 's' : ''}` : 'Continue'; }
        function handleSaveSettings() { selectedSubjects = Array.from(document.querySelectorAll('#settingsSubjectGrid .subject-card.selected')).map(card => card.dataset.subject); saveData(); hideModal('settingsModal'); if (selectedSubjects.length > 0) { showView('dashboard'); } else { showView('onboarding'); } }
        function updateSaveButtonState() { const saveBtn = document.getElementById('saveSettings'); if (saveBtn) saveBtn.disabled = document.querySelectorAll('#settingsSubjectGrid .subject-card.selected').length === 0; }
                
        function startCountdown() { const el=document.getElementById('countdownTimer');const d=new Date('2026-05-14T09:00:00');function t(){const o=d-new Date;if(o<=0){el.innerHTML="<h2>Exams Started!</h2>";stopCountdown();return}const e=Math.floor(o/864e5),n=Math.floor(o%864e5/36e5),a=Math.floor(o%36e5/6e4),i=Math.floor(o%6e4/1e3);el.innerHTML=`<div class="countdown-item"><span class="value">${e}</span><span class="label">Days</span></div><div class="countdown-item"><span class="value">${n}</span><span class="label">Hours</span></div><div class="countdown-item"><span class="value">${a}</span><span class="label">Minutes</span></div><div class="countdown-item"><span class="value">${i}</span><span class="label">Seconds</span></div>`}stopCountdown();t();countdownInterval=setInterval(t,1e3)}
        function stopCountdown() { clearInterval(countdownInterval); }
        
        function renderOnboardingContent() { const grid = document.getElementById('onboardingSubjectGrid'); if (!grid) return; grid.innerHTML = ''; Object.keys(subjectsData).forEach((subject, index) => { const subjectInfo = subjectsData[subject]; const examBoard = Object.keys(subjectInfo.specifications)[0]; const card = document.createElement('div'); card.className = 'subject-card'; card.dataset.subject = subject; if (selectedSubjects.includes(subject)) card.classList.add('selected'); card.innerHTML = `<h3>${subject}</h3><span class="exam-board-pill">${examBoard}</span>`; card.style.animationDelay = `${index * 50}ms`; grid.appendChild(card); }); updateContinueButton(); }
        function renderDashboardContent() { const grid = document.getElementById('dashboardSubjectGrid'); if (!grid) return; grid.innerHTML = ''; selectedSubjects.forEach((subject, index) => { const subjectInfo = subjectsData[subject]; const examBoard = Object.keys(subjectInfo.specifications)[0]; const card = document.createElement('div'); card.className = 'subject-card'; card.dataset.subject = subject; card.innerHTML = `<h3>${subject}</h3><span class="exam-board-pill">${examBoard}</span>`; card.style.animationDelay = `${index * 50}ms`; grid.appendChild(card); }); }
        function renderSettingsModal() { const grid = document.getElementById('settingsSubjectGrid'); grid.innerHTML = ''; Object.keys(subjectsData).forEach(subject => { const subjectInfo = subjectsData[subject]; const examBoard = Object.keys(subjectInfo.specifications)[0]; const isSelected = selectedSubjects.includes(subject); const card = document.createElement('div'); card.className = 'subject-card'; if (isSelected) card.classList.add('selected'); card.dataset.subject = subject; card.innerHTML = `<h3>${subject}</h3><span class="exam-board-pill">${examBoard}</span>`; grid.appendChild(card); }); updateSaveButtonState(); }

    </script>
</body>
</html>
